<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8" />
    <title>The Dragon!</title>
    <link href="css/reset.css" rel="stylesheet" />
    <link href="css/main.css" rel="stylesheet" />
    <script src="http://ajax.googleapis.com/ajax/libs/jquery/1.7.1/jquery.min.js" type="text/javascript"></script>
</head>
<body>
    <div id="impress">
        <div id="intro" class="step slide backgroundimageindex">
            <!-- Intro page. Title of the game-->
            <div class="slide-text">
                <p><a href="#whiterun">Start the game</a></p>

            </div>
        </div>

        <!--Briefly explains the situation to the user-->
        <div id="whiterun" class="step slide backgroundimage" data-x="1500">
            <div class="slide-text ">
                <p>The town of WhiteRun has been attacked by a dragon.</p>
                <p>The mayor seeks your help in slaying the fierce creature.</p>
                <p>Will you take up the challenge and slay the dragon and save the town ??</p>
                <p><a href="#attack">Continue</a></p>

            </div>
        </div>

        <!-- Another slide that shows dragon attacking the village. Can go talk to the villager or visit the king-->
        <div id="attack" class="step slide dragonattack" data-x="1500">
            <div class="slide-text">
                <p><a href="#villager">Talk to the villager</a></p>
                <p><a href="#mayor">Visit the Mayor of the Town</a></p>
            </div>
        </div>

        <div id="mayor" class="step slide mayormeet" data-x="-1500" data-y="1500">
            <div class="slide-text">
                <p>The king announces the reward for slaying the dragon.</p>
                <p><a href="#attack">Go back to the village</a></p>
                <p><a href="#route1">Start for the mountain</a></p>
            </div>
        </div>
        <div id="route1" class="step slide route1" data-x="-1500" data-y="1500">
            <div class="slide-text">
                <p>Continue along the road.</p>
                <p><a href="#fight">Continue along the road.</a></p>
            </div>
        </div>
        <div id="villager" class="step slide villager" data-x="1500" data-y="1500">
            <div class="slide-text">
                <p>you have seen the villager</p>
                <p><a href="#intro">Start over</a></p>
                <p><a href="#fight">Fight</a></p>
            </div>
        </div>
        <div id="fight" class="step slide cave" data-x="1500" data-y="1500">
            <div class="slide-text">
                <canvas id="gameframe" width="1366" height="768"></canvas>
                <p><a href="#intro">Back to main page</a></p>
            </div>
        </div>
        <div id="success" class="step slide cave" data-x="1500" data-y="1500">
            <div class="slide-text">
                <p style="color: white">Hello world</p>
                <p><a href="#intro">Start Over</a></p>
            </div>
        </div>

    </div>


    <!-- JavaScript Section -->
    <script src="js/impress.js"></script>
    <script>impress().init();</script>
    <script>
        (function () {
            var canvas = jQuery("#gameframe")[0];
            var ctx = canvas.getContext("2d");
            var w = jQuery("#gameframe").width();
            var h = jQuery("#gameframe").height();
            var position = { x: 0, y: 0 };
            var duration = 5000;

            var cellwidth = 50;
            var score = 0;
            var bgimage = new Image();
            bgimage.src = "assets/images/darkcaves.jpg";

            var dragon = new Image();
            dragon.src = "assets/images/dragonright.png";

            function render() {
                ctx.drawImage(bgimage, 0, 0);
                ctx.drawImage(dragon, w, 100, 200, 300);
            }

            function init() {
                setInt = setInterval(paint, duration);
            }

            init();

            //function to check if the dragon has been shot
            canvas.addEventListener('click', function (event) {
                var row = Math.floor((event.pageY - canvas.offsetTop) / 50);
                var col = Math.floor((event.pageX - canvas.offsetLeft) / 50);
                console.log(" score : " + score);
                window.location.href = "#success";
                //if (((col >= (pos.x+10)) && (row >= pos.y+10)) || (col <= pos.x-10) && (row>= pos.y-10)) 
                //{
                //    paint();
                //    score += 1;
                //    duration = duration - 100;
                //    $("#score").text(score);

                //    clearInterval(setInt);
                //    init();
                //}
            }, false);

            ////to find random position for the duck
            function newPosition() {
                pos = {
                    x: Math.round(Math.random() * (w - cellwidth) / cellwidth),
                    y: Math.round(Math.random() * (h - cellwidth) / cellwidth),
                };
            }

            ////move the duck to a new position
            function paint() {
                img1 = document.getElementById("lake");
                ctx.drawImage(bgimage, 0, 0);
                ctx.strokeRect(0, 0, w, h);
                newPosition();
                
                ctx.drawImage(dragon, pos.x * cellwidth, pos.y * cellwidth, 120, 144);
            }

            render();
        })();
    </script>

</body>
</html>
